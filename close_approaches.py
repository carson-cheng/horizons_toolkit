#https://ssd.jpl.nasa.gov/api/horizons.api?command=1&obj_data=yes&make_ephem=yes&ephem_type=vectors&start_time=2024-Oct-11&stop_time=2030-Apr-11
from plot_ephemeris import *
import requests, ssl, math, time
start_date = "2027-Jan-01"
stop_date = "2033-Mar-03"
au = 149597870.7
coordinate1 = read_ephemeris(get_object_ephemeris(-49, start_date, stop_date), start_date, stop_date)
#print(coordinate1)
#print("Europa clipper read")
#print(len(coordinate1[0]))
#x1, y1, z1 = coordinate1[0], coordinate1[1], coordinate1[2]
def distance(x1, y1, z1, x2, y2, z2):
    return abs(math.sqrt((x2-x1)**2 + (y2-y1)**2 + (z2-z1)**2))
def get_perihelion_distance(asteroid_number):
    url = "https://ssd-api.jpl.nasa.gov/sbdb.api?spk=" + str(2000000 + asteroid_number)
    data = requests.get(url).text
    data_points = data.split("{")
    for item in data_points:
        if "perihelion distance" in item:
            return float(item.split('"')[3])
def closest_approach(asteroid_number, coordinate_list, start_date, stop_date):
    ephemeris = get_object_ephemeris(asteroid_number, start_date, stop_date)
    #print(len(ephemeris))
    coordinate2 = read_ephemeris(ephemeris, start_date, stop_date)
    #print(len(coordinate2[0]))
    distances = []
    for item in range(len(coordinate_list[0])):
        x1, y1, z1 = coordinate_list[0][item], coordinate_list[1][item], coordinate_list[2][item]
        x2, y2, z2 = coordinate2[0][item], coordinate2[1][item], coordinate2[2][item]
        distances.append(distance(x1, y1, z1, x2, y2, z2))
    if min(distances) / au > 0.05:
        print("Minimum distance for " + str(asteroid_number) + ": " + str(min(distances) / au) + " AU")
    else:
        print("Minimum distance for " + str(asteroid_number) + ": \u001b[32;1m\u001b[1m" + str(min(distances) / au) + " AU\u001b[0m")
    #print(len(distances))
target_lst = ["'DES=2000588'", "'DES=2000617'", "'DES=2000624'", "'DES=2000659'", "'DES=2000884'", "'DES=2000911'", "'DES=2001143'", "'DES=2001172'", "'DES=2001173'", "'DES=2001208'", "'DES=2001404'", "'DES=2001437'", "'DES=2001583'", "'DES=2001647'", "'DES=2001749'", "'DES=2001867'", "'DES=2001868'", "'DES=2001869'", "'DES=2001870'", "'DES=2001871'", "'DES=2001872'", "'DES=2001873'", "'DES=2002146'", "'DES=2002148'", "'DES=2002207'", "'DES=2002223'", "'DES=2002241'", "'DES=2002260'", "'DES=2002357'", "'DES=2002363'", "'DES=2002456'", "'DES=2002594'", "'DES=2002674'", "'DES=2002759'", "'DES=2002797'", "'DES=2002893'", "'DES=2002895'", "'DES=2002920'", "'DES=2003063'", "'DES=2003240'", "'DES=2003317'", "'DES=2003391'", "'DES=2003451'", "'DES=2003540'", "'DES=2003548'", "'DES=2003564'", "'DES=2003596'", "'DES=2003708'", "'DES=2003709'", "'DES=2003793'", "'DES=2003794'", "'DES=2003801'", "'DES=2004007'", "'DES=2004035'", "'DES=2004057'", "'DES=2004060'", "'DES=2004063'", "'DES=2004068'", "'DES=2004086'", "'DES=2004138'", "'DES=2004348'", "'DES=2004489'", "'DES=2004501'", "'DES=2004543'", "'DES=2004707'", "'DES=2004708'", "'DES=2004709'", "'DES=2004715'", "'DES=2004722'", "'DES=2004754'", "'DES=2004791'", "'DES=2004792'", "'DES=2004805'", "'DES=2004827'", "'DES=2004828'", "'DES=2004829'", "'DES=2004832'", "'DES=2004833'", "'DES=2004834'", "'DES=2004835'", "'DES=2004836'", "'DES=2004867'", "'DES=2004902'", "'DES=2004946'", "'DES=2005012'", "'DES=2005023'", "'DES=2005025'", "'DES=2005027'", "'DES=2005028'", "'DES=2005041'", "'DES=2005119'", "'DES=2005120'", "'DES=2005123'", "'DES=2005126'", "'DES=2005130'", "'DES=2005144'", "'DES=2005209'", "'DES=2005233'", "'DES=2005244'", "'DES=2005254'", "'DES=2005257'", "'DES=2005258'", "'DES=2005259'", "'DES=2005264'", "'DES=2005283'", "'DES=2005284'", "'DES=2005285'", "'DES=2005436'", "'DES=2005476'", "'DES=2005511'", "'DES=2005637'", "'DES=2005638'", "'DES=2005648'", "'DES=2005652'", "'DES=2005907'", "'DES=2006002'", "'DES=2006090'", "'DES=2006443'", "'DES=2006545'", "'DES=2006997'", "'DES=2006998'", "'DES=2007119'", "'DES=2007152'", "'DES=2007214'", "'DES=2007352'", "'DES=2007543'", "'DES=2007641'", "'DES=2007815'", "'DES=2008060'", "'DES=2008125'", "'DES=2008241'", "'DES=2008317'", "'DES=2009023'", "'DES=2009030'", "'DES=2009142'", "'DES=2009430'", "'DES=2009431'", "'DES=2009590'", "'DES=2009694'", "'DES=2009712'", "'DES=2009713'", "'DES=2009790'", "'DES=2009799'", "'DES=2009807'", "'DES=2009817'", "'DES=2009818'", "'DES=2009828'", "'DES=2009857'", "'DES=2009907'", "'DES=2010247'", "'DES=2010664'", "'DES=2010989'", "'DES=2011089'", "'DES=2011251'", "'DES=2011252'", "'DES=2011273'", "'DES=2011275'", "'DES=2011351'", "'DES=2011395'", "'DES=2011396'", "'DES=2011397'", "'DES=2011428'", "'DES=2011429'", "'DES=2011487'", "'DES=2011488'", "'DES=2011509'", "'DES=2011552'", "'DES=2011554'", "'DES=2011663'", "'DES=2011668'", "'DES=2011869'", "'DES=2011887'", "'DES=2012052'", "'DES=2012054'", "'DES=2012126'", "'DES=2012238'", "'DES=2012242'", "'DES=2012444'", "'DES=2012649'", "'DES=2012658'", "'DES=2012714'", "'DES=2012916'", "'DES=2012917'", "'DES=2012921'", "'DES=2012929'", "'DES=2012972'", "'DES=2012973'", "'DES=2012974'", "'DES=2013060'", "'DES=2013062'", "'DES=2013181'", "'DES=2013182'", "'DES=2013183'", "'DES=2013184'", "'DES=2013185'", "'DES=2013229'", "'DES=2013230'", "'DES=2013323'", "'DES=2013331'", "'DES=2013353'", "'DES=2013362'", "'DES=2013366'", "'DES=2013372'", "'DES=2013379'", "'DES=2013383'", "'DES=2013385'", "'DES=2013387'", "'DES=2013402'", "'DES=2013463'", "'DES=2013475'", "'DES=2013650'", "'DES=2013694'", "'DES=2013780'", "'DES=2013782'", "'DES=2013790'", "'DES=2013862'", "'DES=2014235'", "'DES=2014268'", "'DES=2014518'", "'DES=2014690'", "'DES=2014707'", "'DES=2014791'", "'DES=2014792'", "'DES=2015033'", "'DES=2015094'", "'DES=2015398'", "'DES=2015436'", "'DES=2015440'", "'DES=2015442'", "'DES=2015502'", "'DES=2015521'", "'DES=2015527'", "'DES=2015529'", "'DES=2015535'", "'DES=2015536'", "'DES=2015539'", "'DES=2015651'", "'DES=2015663'", "'DES=2015913'", "'DES=2015977'", "'DES=2016070'", "'DES=2016099'", "'DES=2016152'", "'DES=2016428'", "'DES=2016560'", "'DES=2016667'", "'DES=2016956'", "'DES=2016974'", "'DES=2017171'", "'DES=2017172'", "'DES=2017314'", "'DES=2017351'", "'DES=2017365'", "'DES=2017414'", "'DES=2017415'", "'DES=2017416'", "'DES=2017417'", "'DES=2017418'", "'DES=2017419'", "'DES=2017420'", "'DES=2017421'", "'DES=2017423'", "'DES=2017424'", "'DES=2017442'", "'DES=2017492'", "'DES=2017874'", "'DES=2018037'", "'DES=2018046'", "'DES=2018054'", "'DES=2018058'", "'DES=2018060'", "'DES=2018062'", "'DES=2018063'", "'DES=2018071'", "'DES=2018137'", "'DES=2018228'", "'DES=2018263'", "'DES=2018268'", "'DES=2018278'", "'DES=2018281'", "'DES=2018282'", "'DES=2018493'", "'DES=2018940'", "'DES=2018971'", "'DES=2019018'", "'DES=2019020'", "'DES=2019725'", "'DES=2019844'", "'DES=2019913'", "'DES=2020144'", "'DES=2020424'", "'DES=2020428'", "'DES=2020716'", "'DES=2020720'", "'DES=2020729'", "'DES=2020738'", "'DES=2020739'", "'DES=2020947'", "'DES=2020952'", "'DES=2020961'", "'DES=2020995'", "'DES=2021271'", "'DES=2021284'", "'DES=2021370'", "'DES=2021371'", "'DES=2021372'", "'DES=2021593'", "'DES=2021595'", "'DES=2021599'", "'DES=2021601'", "'DES=2021602'", "'DES=2021900'", "'DES=2022008'", "'DES=2022009'", "'DES=2022010'", "'DES=2022012'", "'DES=2022014'", "'DES=2022035'", "'DES=2022041'", "'DES=2022042'", "'DES=2022049'", "'DES=2022052'", "'DES=2022054'", "'DES=2022055'", "'DES=2022056'", "'DES=2022059'", "'DES=2022149'", "'DES=2022180'", "'DES=2022199'", "'DES=2022203'", "'DES=2022222'", "'DES=2022227'", "'DES=2022404'", "'DES=2022503'", "'DES=2022808'", "'DES=2023075'", "'DES=2023114'", "'DES=2023118'", "'DES=2023119'", "'DES=2023123'", "'DES=2023126'", "'DES=2023135'", "'DES=2023144'", "'DES=2023152'", "'DES=2023269'", "'DES=2023285'", "'DES=2023355'", "'DES=2023382'", "'DES=2023383'", "'DES=2023463'", "'DES=2023480'", "'DES=2023549'", "'DES=2023622'", "'DES=2023624'", "'DES=2023694'", "'DES=2023706'", "'DES=2023709'", "'DES=2023710'", "'DES=2023939'", "'DES=2023947'", "'DES=2023958'", "'DES=2023963'", "'DES=2023968'", "'DES=2023970'", "'DES=2023987'", "'DES=2024018'", "'DES=2024022'", "'DES=2024212'", "'DES=2024225'", "'DES=2024233'", "'DES=2024244'", "'DES=2024275'", "'DES=2024279'", "'DES=2024312'", "'DES=2024313'", "'DES=2024340'", "'DES=2024341'", "'DES=2024357'", "'DES=2024380'", "'DES=2024390'", "'DES=2024403'", "'DES=2024420'", "'DES=2024426'", "'DES=2024444'", "'DES=2024446'", "'DES=2024448'", "'DES=2024449'", "'DES=2024451'", "'DES=2024452'", "'DES=2024453'", "'DES=2024454'", "'DES=2024456'", "'DES=2024458'", "'DES=2024459'", "'DES=2024467'", "'DES=2024470'", "'DES=2024471'", "'DES=2024472'", "'DES=2024479'", "'DES=2024485'", "'DES=2024486'", "'DES=2024498'", "'DES=2024501'", "'DES=2024505'", "'DES=2024506'", "'DES=2024508'", "'DES=2024519'", "'DES=2024528'", "'DES=2024530'", "'DES=2024531'", "'DES=2024534'", "'DES=2024536'", "'DES=2024537'", "'DES=2024539'", "'DES=2024587'", "'DES=2024603'", "'DES=2024882'", "'DES=2025344'", "'DES=2025347'", "'DES=2025883'", "'DES=2025895'", "'DES=2025910'", "'DES=2025911'", "'DES=2025937'", "'DES=2025938'", "'DES=2026057'", "'DES=2026486'", "'DES=2026510'", "'DES=2026601'", "'DES=2026705'", "'DES=2026763'", "'DES=2028958'", "'DES=2028960'", "'DES=2029196'", "'DES=2029314'", "'DES=2029603'", "'DES=2029976'", "'DES=2029977'", "'DES=2030020'", "'DES=2030102'", "'DES=2030498'", "'DES=2030499'", "'DES=2030504'", "'DES=2030505'", "'DES=2030506'", "'DES=2030508'", "'DES=2030510'", "'DES=2030698'", "'DES=2030704'", "'DES=2030705'", "'DES=2030708'", "'DES=2030791'", "'DES=2030792'", "'DES=2030793'", "'DES=2030806'", "'DES=2030807'", "'DES=2030942'", "'DES=2031037'", "'DES=2031342'", "'DES=2031344'", "'DES=2031806'", "'DES=2031814'", "'DES=2031819'", "'DES=2031820'", "'DES=2031821'", "'DES=2031835'", "'DES=2032339'", "'DES=2032356'", "'DES=2032370'", "'DES=2032396'", "'DES=2032397'", "'DES=2032420'", "'DES=2032430'", "'DES=2032434'", "'DES=2032435'", "'DES=2032437'", "'DES=2032440'", "'DES=2032451'", "'DES=2032461'", "'DES=2032464'", "'DES=2032467'", "'DES=2032471'", "'DES=2032475'", "'DES=2032478'", "'DES=2032480'", "'DES=2032482'", "'DES=2032496'", "'DES=2032498'", "'DES=2032499'", "'DES=2032501'", "'DES=2032513'", "'DES=2032615'", "'DES=2032720'", "'DES=2032726'", "'DES=2032794'", "'DES=2032811'", "'DES=2033822'", "'DES=2034298'", "'DES=2034521'", "'DES=2034553'", "'DES=2034642'", "'DES=2034684'", "'DES=2034746'", "'DES=2034785'", "'DES=2034835'", "'DES=2034993'", "'DES=2035272'", "'DES=2035276'", "'DES=2035277'", "'DES=2035363'", "'DES=2035672'", "'DES=2035673'", "'DES=2036259'", "'DES=2036265'", "'DES=2036267'", "'DES=2036268'", "'DES=2036269'", "'DES=2036270'", "'DES=2036271'", "'DES=2036279'", "'DES=2036425'", "'DES=2036624'", "'DES=2036922'", "'DES=2037281'", "'DES=2037297'", "'DES=2037298'", "'DES=2037299'", "'DES=2037300'", "'DES=2037301'", "'DES=2037519'", "'DES=2037572'", "'DES=2037685'", "'DES=2037710'", "'DES=2037714'", "'DES=2037715'", "'DES=2037716'", "'DES=2037732'", "'DES=2037789'", "'DES=2037790'", "'DES=2038050'", "'DES=2038051'", "'DES=2038052'", "'DES=2038257'", "'DES=2038574'", "'DES=2038585'", "'DES=2038592'", "'DES=2038594'", "'DES=2038596'", "'DES=2038597'", "'DES=2038598'", "'DES=2038599'", "'DES=2038600'", "'DES=2038606'", "'DES=2038607'", "'DES=2038609'", "'DES=2038610'", "'DES=2038611'", "'DES=2038614'", "'DES=2038615'", "'DES=2038617'", "'DES=2038619'", "'DES=2038621'", "'DES=2039229'", "'DES=2039264'", "'DES=2039270'", "'DES=2039275'", "'DES=2039278'", "'DES=2039280'", "'DES=2039284'", "'DES=2039285'", "'DES=2039286'", "'DES=2039287'", "'DES=2039288'", "'DES=2039289'", "'DES=2039292'", "'DES=2039293'", "'DES=2039362'", "'DES=2039369'", "'DES=2039463'", "'DES=2039474'", "'DES=2039691'", "'DES=2039692'", "'DES=2039693'", "'DES=2039793'", "'DES=2039794'", "'DES=2039795'", "'DES=2039797'", "'DES=2039798'", "'DES=2039803'", "'DES=2040237'", "'DES=2040262'", "'DES=2041268'", "'DES=2041340'", "'DES=2041342'", "'DES=2041350'", "'DES=2041353'", "'DES=2041355'", "'DES=2041359'", "'DES=2041379'", "'DES=2041417'", "'DES=2041426'", "'DES=2041427'", "'DES=2042036'", "'DES=2042114'", "'DES=2042146'", "'DES=2042168'", "'DES=2042176'", "'DES=2042179'", "'DES=2042182'", "'DES=2042187'", "'DES=2042200'", "'DES=2042201'", "'DES=2042230'", "'DES=2042277'", "'DES=2042367'", "'DES=2042403'", "'DES=2042554'", "'DES=2042555'", "'DES=2043212'", "'DES=2043436'", "'DES=2043627'", "'DES=2043706'", "'DES=2045822'", "'DES=2046676'", "'DES=2047955'", "'DES=2047956'", "'DES=2047957'", "'DES=2047959'", "'DES=2047962'", "'DES=2047963'", "'DES=2047964'", "'DES=2047967'", "'DES=2047969'", "'DES=2048249'", "'DES=2048252'", "'DES=2048254'", "'DES=2048269'", "'DES=2048373'", "'DES=2048438'", "'DES=2048604'", "'DES=2048764'", "'DES=2048767'"]
for item in target_lst:
            try:
                closest_approach(item, coordinate1, start_date, stop_date)
            except:
                try:
                    print("Server error, waiting for 30 seconds")
                    time.sleep(30)
                    closest_approach(item, coordinate1, start_date, stop_date)
                except:
                    print("Invalid request. Not investigating this object.")
                    pass
